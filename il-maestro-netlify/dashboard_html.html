<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ordini - Il Maestro</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22Dashboard%20Il%20Maestro%22,%22short_name%22:%22Dashboard%22,%22description%22:%22Dashboard%20ordini%20per%20Il%20Maestro%20Paninoteca%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23667eea%22,%22theme_color%22:%22%23667eea%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle' fill='white'%3Eüìä%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle' fill='white'%3Eüìä%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Dashboard Il Maestro">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle' fill='white'%3Eüìä%3C/text%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: 
                linear-gradient(rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff6b6b' fill-opacity='0.2'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm15 15c0-5.523-4.477-10-10-10s-10 4.477-10 10 4.477 10 10 10 10-4.477 10-10z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23feca57' fill-opacity='0.15'%3E%3Cpath d='M20 20.5V18H5v-2h15v-2.5L25.5 18 20 22.5V20.5zm-5 0V18h10v2H15v.5L9.5 18 15 15.5V18z' opacity='0.5'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 120px 120px, 80px 80px;
            background-position: 0 0, 40px 40px;
            padding: 15px;
            min-height: 100vh;
        }

        /* PWA Install Prompt */
        .install-prompt {
            position: fixed;
            top: 80px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            z-index: 1500;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .install-prompt.show {
            display: block;
        }

        .install-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .install-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .install-btn.primary {
            background: #667eea;
            color: white;
        }

        .install-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: rgba(248, 249, 250, 0.9);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            .orders-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        .order-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 18px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            animation: slideIn 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .order-card.new {
            border: 3px solid #4caf50;
            animation: pulse 2s infinite;
            box-shadow: 0 5px 25px rgba(76, 175, 80, 0.3);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(240, 240, 240, 0.7);
        }

        .order-id {
            font-weight: bold;
            color: #667eea;
        }

        .order-time {
            color: #999;
            font-size: 0.9em;
        }

        .customer-info {
            background: rgba(248, 249, 250, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .order-items {
            margin: 15px 0;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .order-total {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            text-align: right;
            margin: 15px 0;
        }

        .order-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .btn-accept {
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-ready {
            background: rgba(255, 152, 0, 0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-complete {
            background: rgba(33, 150, 243, 0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-reject {
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .no-orders {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: #999;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .badge-new { 
            background: rgba(227, 242, 253, 0.9); 
            color: #1976d2; 
            border: 1px solid rgba(25, 118, 210, 0.3);
        }
        
        .badge-accepted { 
            background: rgba(232, 245, 233, 0.9); 
            color: #388e3c; 
            border: 1px solid rgba(56, 142, 60, 0.3);
        }
        
        .badge-ready { 
            background: rgba(255, 243, 224, 0.9); 
            color: #f57c00; 
            border: 1px solid rgba(245, 124, 0, 0.3);
        }
        
        .badge-completed { 
            background: rgba(224, 242, 241, 0.9); 
            color: #00796b; 
            border: 1px solid rgba(0, 121, 107, 0.3);
        }

        .sound-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }

        .sound-control:hover {
            transform: scale(1.1);
        }

        /* Push notification toast */
        .push-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 3000;
            animation: slideInRight 0.3s;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .order-card {
                padding: 15px;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-value {
                font-size: 1.8em;
            }

            .push-notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <strong>üìä Installa Dashboard Il Maestro</strong>
        <p>Ricevi notifiche push per i nuovi ordini anche quando l'app √® chiusa!</p>
        <div class="install-buttons">
            <button class="install-btn primary" id="installBtn">Installa</button>
            <button class="install-btn secondary" id="dismissBtn">Pi√π tardi</button>
        </div>
    </div>

    <div class="header">
        <h1>üçî Dashboard Ordini - Il Maestro Melfi</h1>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="todayOrders">0</div>
                <div class="stat-label">Ordini Oggi</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalRevenue">‚Ç¨0</div>
                <div class="stat-label">Incasso Oggi</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeOrders">0</div>
                <div class="stat-label">In Attesa</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgTime">-</div>
                <div class="stat-label">Tempo Medio</div>
            </div>
        </div>
    </div>

    <div id="ordersContainer" class="orders-grid">
        <div class="no-orders">
            <h2>In attesa di ordini...</h2>
            <p>Gli ordini appariranno qui automaticamente</p>
            <p style="margin-top: 20px; color: #667eea;">üì± Telefono: 389 648 7569</p>
        </div>
    </div>

    <div class="sound-control" onclick="toggleSound()">
        <span id="soundIcon">üîî</span>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCSTbBGCs2m6Z4k5euz0DMAvX8y_azcO1Q",
            authDomain: "il-maestro-app.firebaseapp.com",
            databaseURL: "https://il-maestro-app-default-rtdb.firebaseio.com",
            projectId: "il-maestro-app",
            storageBucket: "il-maestro-app.firebasestorage.app",
            messagingSenderId: "309138548046",
            appId: "1:309138548046:web:efec8ce37e882198c66a1f"
        };

        let soundEnabled = true;
        let orders = {};
        let deferredPrompt;
        let database;

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();

        // Initialize PWA
        document.addEventListener('DOMContentLoaded', function() {
            initPWA();
            initFirebase();
        });

        function initPWA() {
            // Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript,const%20CACHE_NAME%3D%22dashboard-maestro-v1%22%3Bself.addEventListener%28%22install%22%2Ce%3D%3Eself.skipWaiting%28%29%29%3Bself.addEventListener%28%22activate%22%2Ce%3D%3Ee.waitUntil%28clients.claim%28%29%29%29%3Bself.addEventListener%28%22fetch%22%2Ce%3D%3E%7Be.respondWith%28caches.match%28e.request%29.then%28t%3D%3Et%7C%7Cfetch%28e.request%29.catch%28%29%3D%3Ecaches.match%28%22/%22%29%29%29%3B%7D%29%3Bself.addEventListener%28%22push%22%2Ce%3D%3E%7Bconst%20t%3De.data%3Fe.data.json%28%29%3A%7Btitle%3A%22Nuovo%20Ordine%21%22%2Cbody%3A%22%C3%88%20arrivato%20un%20nuovo%20ordine%22%7D%3Bself.registration.showNotification%28t.title%2C%7Bbody%3At.body%2Cicon%3A%22data%3Aimage/svg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A//www.w3.org/2000/svg%27%2520viewBox%3D%270%25200%2520100%2520100%27%253E%253Ccircle%2520cx%3D%2750%27%2520cy%3D%2750%27%2520r%3D%2750%27%2520fill%3D%27%2523667eea%27/%253E%253Ctext%2520x%3D%2750%27%2520y%3D%2765%27%2520font-size%3D%2750%27%2520text-anchor%3D%27middle%27%2520fill%3D%27white%27%253E%F0%9F%8D%94%253C/text%253E%253C/svg%253E%22%2Cbadge%3A%22data%3Aimage/svg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A//www.w3.org/2000/svg%27%2520viewBox%3D%270%25200%2520100%2520100%27%253E%253Ccircle%2520cx%3D%2750%27%2520cy%3D%2750%27%2520r%3D%2550%27%2520fill%3D%27%2523667eea%27/%253E%253Ctext%2520x%3D%2750%27%2520y%3D%2765%27%2520font-size%3D%2750%27%2520text-anchor%3D%27middle%27%2520fill%3D%27white%27%253E%F0%9F%94%94%253C/text%253E%253C/svg%253E%22%2Cvibrate%3A%5B200%2C100%2C200%5D%7D%29%3B%7D%29%3B')
                .then(reg => {
                    console.log('SW registered');
                    
                    // Request notification permission
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission();
                    }
                })
                .catch(err => console.log('SW registration failed'));
            }

            // Install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install prompt after 3 seconds
                setTimeout(() => {
                    if (!localStorage.getItem('dashboardInstallDismissed')) {
                        document.getElementById('installPrompt').classList.add('show');
                    }
                }, 3000);
            });

            // Install button
            document.getElementById('installBtn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        console.log('Dashboard installed');
                        showPushNotification('Dashboard installata!', 'Ora riceverai notifiche per i nuovi ordini');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').classList.remove('show');
                }
            });

            // Dismiss button
            document.getElementById('dismissBtn').addEventListener('click', () => {
                document.getElementById('installPrompt').classList.remove('show');
                localStorage.setItem('dashboardInstallDismissed', 'true');
            });
        }

        function initFirebase() {
            // Listen for orders
            database.ref('orders').on('value', (snapshot) => {
                const newOrders = snapshot.val() || {};
                
                // Check for new orders
                Object.keys(newOrders).forEach(key => {
                    if (!orders[key] && newOrders[key].status === 'nuovo') {
                        playNotification();
                        showPushNotification('Nuovo Ordine!', `${newOrders[key].customer.name} - ‚Ç¨${newOrders[key].total.toFixed(2)}`);
                    }
                });
                
                orders = newOrders;
                renderOrders();
                updateStats();
            });
        }

        function showPushNotification(title, body) {
            // Show in-app notification
            const notification = document.createElement('div');
            notification.className = 'push-notification';
            notification.innerHTML = `
                <strong>${title}</strong><br>
                <small>${body}</small>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);

            // Browser notification if supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3Eüçî%3C/text%3E%3C/svg%3E",
                    badge: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3Eüîî%3C/text%3E%3C/svg%3E",
                    vibrate: [200, 100, 200],
                    requireInteraction: true
                });
            }
        }

        function renderOrders() {
            const container = document.getElementById('ordersContainer');
            const orderArray = Object.entries(orders).map(([key, order]) => ({
                ...order,
                key
            }));
            
            // Sort by timestamp (newest first)
            orderArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            if (orderArray.length === 0) {
                container.innerHTML = `
                    <div class="no-orders">
                        <h2>In attesa di ordini...</h2>
                        <p>Gli ordini appariranno qui automaticamente</p>
                        <p style="margin-top: 20px; color: #667eea;">üì± Telefono: 389 648 7569</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = orderArray.map(order => {
                const time = new Date(order.timestamp).toLocaleTimeString('it-IT', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusBadge = {
                    'nuovo': 'badge-new',
                    'accettato': 'badge-accepted',
                    'pronto': 'badge-ready',
                    'completato': 'badge-completed'
                }[order.status] || 'badge-new';

                const statusText = {
                    'nuovo': 'NUOVO',
                    'accettato': 'ACCETTATO',
                    'pronto': 'PRONTO',
                    'completato': 'COMPLETATO'
                }[order.status] || 'NUOVO';

                return `
                    <div class="order-card ${order.status === 'nuovo' ? 'new' : ''}">
                        <div class="order-header">
                            <span class="order-id">#${order.id || order.key.substr(-6)}</span>
                            <span>
                                <span class="badge ${statusBadge}">${statusText}</span>
                                <span class="order-time">${time}</span>
                            </span>
                        </div>
                        
                        <div class="customer-info">
                            <strong>üë§ ${order.customer.name}</strong><br>
                            üìû ${order.customer.phone}<br>
                            üìç ${order.customer.address}
                            ${order.customer.notes ? '<br>üìù ' + order.customer.notes : ''}
                        </div>

                        <div class="order-items">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <span>${item.quantity}x ${item.name}</span>
                                    <span>‚Ç¨${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>

                        <div class="order-total">
                            TOTALE: ‚Ç¨${order.total.toFixed(2)}
                        </div>

                        <div class="order-actions">
                            ${getActionButtons(order)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getActionButtons(order) {
            switch(order.status) {
                case 'nuovo':
                    return `
                        <button class="btn btn-accept" onclick="updateStatus('${order.key}', 'accettato')">
                            ‚úÖ Accetta
                        </button>
                        <button class="btn btn-reject" onclick="updateStatus('${order.key}', 'rifiutato')">
                            ‚ùå Rifiuta
                        </button>
                    `;
                case 'accettato':
                    return `
                        <button class="btn btn-ready" onclick="updateStatus('${order.key}', 'pronto')">
                            üîî Pronto!
                        </button>
                    `;
                case 'pronto':
                    return `
                        <button class="btn btn-complete" onclick="updateStatus('${order.key}', 'completato')">
                            ‚úÖ Consegnato
                        </button>
                    `;
                case 'completato':
                    return '<span style="color: #4caf50;">‚úÖ Completato</span>';
                default:
                    return '';
            }
        }

        function updateStatus(orderId, newStatus) {
            database.ref('orders/' + orderId + '/status').set(newStatus);
            
            if (newStatus === 'pronto') {
                // Call customer
                const order = orders[orderId];
                if (order && order.customer.phone) {
                    showPushNotification('Ordine Pronto!', `${order.customer.name} - Chiamare per consegna`);
                    if (confirm('Chiamare il cliente?\n' + order.customer.name + '\n' + order.customer.phone)) {
                        window.location.href = 'tel:' + order.customer.phone;
                    }
                }
            }
        }

        function updateStats() {
            const orderArray = Object.values(orders);
            const today = new Date().toDateString();
            const todayOrders = orderArray.filter(o => 
                new Date(o.timestamp).toDateString() === today
            );
            
            const revenue = todayOrders.reduce((sum, o) => sum + (o.total || 0), 0);
            const active = orderArray.filter(o => 
                o.status !== 'completato' && o.status !== 'rifiutato'
            ).length;
            
            document.getElementById('todayOrders').textContent = todayOrders.length;
            document.getElementById('totalRevenue').textContent = '‚Ç¨' + revenue.toFixed(0);
            document.getElementById('activeOrders').textContent = active;
            
            // Average time
            const completed = todayOrders.filter(o => o.status === 'completato');
            if (completed.length > 0) {
                const avgMinutes = Math.round(completed.length * 25); // Estimate 25 min average
                document.getElementById('avgTime').textContent = avgMinutes + 'm';
            }
        }

        function playNotification() {
            if (!soundEnabled) return;
            
            // Create beep sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
            
            // Flash screen
            document.body.style.background = '#4caf50';
            setTimeout(() => {
                document.body.style.background = `
                    linear-gradient(rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)),
                    url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff6b6b' fill-opacity='0.2'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm15 15c0-5.523-4.477-10-10-10s-10 4.477-10 10 4.477 10 10 10 10-4.477 10-10z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                    url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23feca57' fill-opacity='0.15'%3E%3Cpath d='M20 20.5V18H5v-2h15v-2.5L25.5 18 20 22.5V20.5zm-5 0V18h10v2H15v.5L9.5 18 15 15.5V18z' opacity='0.5'/%3E%3C/g%3E%3C/svg%3E")
                `;
            }, 300);

            // Vibrate if supported
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundIcon').textContent = soundEnabled ? 'üîî' : 'üîï';
        }

        // Keep screen awake
        if ('wakeLock' in navigator) {
            navigator.wakeLock.request('screen').catch(() => {});
        }
    </script>
</body>
</html>